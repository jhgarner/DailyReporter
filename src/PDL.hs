{-# LANGUAGE OverloadedStrings #-}

module PDL
  ( pdl,
  )
where

import qualified Data.ByteString as B
import Data.Maybe
import Data.Text
import Data.Text.Encoding
import Data.Text.IO
import Text.HTML.Scalpel
import Text.Regex.Posix
import Utils

-- | The final html text generated by scraping poorlydrawnlines.com as well as
--  |their RSS feeds
pdl :: IO Text
pdl = do
  h <- htmlS
  (title, img) <- getTitleAndContent pdlFeed
  pure $ template [("*title", title), ("*img", img)] h

-- | PDL feed URL
pdlFeed :: String
pdlFeed = "http://feeds.feedburner.com/PoorlyDrawnLines?format=xml"

-- | Get poorly drawn lines template (templates/PDL.html)
htmlS :: IO Text
htmlS = Data.Text.IO.readFile "templates/PDL.html"

-- | Scraping logic for PDL
scrapeImg :: Text -> Text
scrapeImg s = decodeUtf8 $ encodeUtf8 s =~ ("<figure.*</figure>" :: B.ByteString)
